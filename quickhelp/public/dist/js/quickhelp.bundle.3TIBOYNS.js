(()=>{frappe.provide("quickhelp");quickhelp.UploadFile=function(e){return new Promise((r,o)=>{let t=new XMLHttpRequest;t.upload.addEventListener("loadstart",i=>{frappe.show_alert({indicator:"green",message:__("Uploading file.")})}),t.upload.addEventListener("progress",i=>{i.lengthComputable&&(console.log(`Upload in progress. ${i.loaded} / ${i.total}`),frappe.show_progress("Uploading",i.loaded,i.total,"",!0))}),t.addEventListener("error",i=>{frappe.show_alert({indicator:"red",message:__("Error uploading file.")}),console.log(i),o()}),t.onreadystatechange=()=>{if(t.readyState==XMLHttpRequest.DONE)if(t.status===200){let i=null,a=null;try{i=JSON.parse(t.responseText),i.message.doctype==="File"&&(a=i.message)}catch(l){console.log(t.responseText),frappe.show_alert({indicator:"red",message:__("Error uploading file.")}),o()}r(a.file_url)}else{let i=null;try{i=JSON.parse(t.responseText),console.log(i)}catch(a){console.log(t.responseText)}frappe.show_alert({indicator:"red",message:__("Error uploading file.")}),o()}},t.open("POST","/api/method/upload_file",!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("X-Frappe-CSRF-Token",frappe.csrf_token);let s=new FormData;s.append("file",e,`screen-rec-${Date.now()}.mp4`),s.append("is_private",frappe.boot.quickhelp_file_type),s.append("folder","Home/QuickHelp"),t.send(s)})};frappe.provide("quickhelp");quickhelp.SupportTicket=class{constructor(){var e,r;if(!frappe.boot.quickhelp_support_enabled){frappe.msgprint({title:__("Support Disabled"),message:__("Support is not enabled for this site. Please contact Administrator."),indicator:"red"});return}if(frappe.session.user==="Administrator"){frappe.msgprint({title:__("Access Denied"),message:__("Administrator cannot create support tickets."),indicator:"orange"});return}this.inUpload=!1,this.init_config(),this.setup_dialog(),(r=(e=this.dialog)==null?void 0:e.show)==null||r.call(e)}init_config(){this.fields=[{label:"Ticket Title",fieldname:"ticket_title",fieldtype:"Data",reqd:1,placeholder:__("Enter a brief description of the issue"),description:__("Summarize the issue in a few words.")},{label:"Module",fieldname:"ticket_module",fieldtype:"Select",options:["Accounts","Buying","Selling","HR","Stock","Projects","CRM","Others"],reqd:1,placeholder:__("Select the module related to the issue"),description:__("Choose the module where the issue is occurring.")},{label:"Description",fieldname:"ticket_description",fieldtype:"Text Editor",reqd:1,placeholder:__("Provide a detailed description of the issue"),description:__("<b>Include steps to reproduce, error messages, Screenshots and any other relevant details.<b>")}]}setup_dialog(){this.dialog=new frappe.ui.Dialog({title:__("Create Support Ticket"),fields:this.fields,primary_action_label:__("Submit"),primary_action:e=>{this.raise_ticket(e)}})}async raise_ticket(e){this.inUpload||(this.inUpload=!0,frappe.call({method:"quickhelp.utils.support.create_ticket",type:"POST",args:{title:e.ticket_title,raised_by:frappe.session.user,ticket_module:e.ticket_module,description:e.ticket_description},freeze:!0,freeze_message:__("Creating ticket..."),callback:r=>{var o,t;this.inUpload=!1,console.log("Create ticket response:",r),r.message&&(frappe.msgprint({title:__("\u{1F3AB} Ticket Created Successfully"),message:__(`\u{1F3AB} Your ticket (#${r.message}) has been created successfully. You can track it from the Support Portal.`),indicator:"green"}),(t=(o=this.dialog)==null?void 0:o.hide)==null||t.call(o))},error:r=>{this.inUpload=!1,console.error("Ticket creation error:",r),frappe.show_alert({indicator:"red",message:__("\u274C An error occurred while creating the ticket.")})}}))}};frappe.after_ajax(()=>{let e=document.createElement("button");e.id="quickhelp-ticket-button",e.innerHTML='<i class="fa fa-ticket"></i> Create Ticket',e.style.position="fixed",e.style.bottom="20px",e.style.right="20px",e.style.zIndex="1000",e.style.padding="10px 20px",e.style.backgroundColor="#28a745",e.style.color="#fff",e.style.border="none",e.style.borderRadius="5px",e.style.cursor="pointer",e.style.boxShadow="0 2px 5px rgba(0, 0, 0, 0.2)",document.body.appendChild(e),e.addEventListener("click",function(){new quickhelp.SupportTicket})});})();
//# sourceMappingURL=quickhelp.bundle.3TIBOYNS.js.map
